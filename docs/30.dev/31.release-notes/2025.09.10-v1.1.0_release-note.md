# D2S v1.1.0 Release Note
**Release Date**: 2025-09-10  
**Version**: 1.1.0  
**Type**: Major Structure Update

## Overview
D2S v1 시스템의 폴더 구조를 대대적으로 개편하여 child-theme과 d2s-v1 코드를 명확히 분리했습니다. 이를 통해 독립적인 repository 관리가 가능해졌습니다.

## 변경 목적
1. **Repository 분리**: WordPress child-theme과 d2s-v1 시스템을 독립적인 Git repository로 관리 가능
2. **코드 격리**: D2S v1 시스템 파일들이 독립적인 폴더에 모여 유지보수 향상
3. **버전 관리 개선**: 두 프로젝트를 독립적으로 버전 관리 가능

## 폴더 구조 변경

### 이전 구조 (v1.0.x)
```
themes/generatepress_child/
├── functions.php
├── templates/                    # 모든 페이지 템플릿
│   └── page-*.php
├── includes/
│   ├── gp-d2s-v1.php            # D2S 시스템 파일
│   └── gp-customize.php
└── d2s-v1/
    ├── common/
    │   └── d2s-v1-common.css
    └── pages/
        └── {page-name}/
```

### 새로운 구조 (v1.1.0)
```
themes/generatepress_child/
├── functions.php
├── templates/                    # 일반 페이지 템플릿만
│   └── page-*.php
├── includes/                     # child-theme 전용
│   ├── gp-customize.php
│   └── gp-blog.php
└── d2s-v1/                       # D2S v1 시스템 루트
    ├── includes/
    │   └── gp-d2s-v1.php        # D2S 시스템 파일 (이동됨)
    ├── common-assets/            # 'assets'에서 이름 변경
    │   ├── css/
    │   │   └── d2s-v1-common.css
    │   ├── js/
    │   └── images/
    ├── page-templates/           # D2S 페이지 템플릿 (이동됨)
    │   └── page-*.php
    ├── page-assets/              # 'pages'에서 이름 변경
    │   └── {page-name}/
    └── docs/
```

## 작업 과정

### 1. CLAUDE.md 파일 개선
- 기존 두 개의 CLAUDE.md 파일 통합
- D2S v1 시스템 문서화 강화
- 새로운 폴더 구조 반영

### 2. functions.php 수정
```php
// 이전
include('includes/gp-d2s-v1.php');

// 변경 후
include('d2s-v1/includes/gp-d2s-v1.php');
```

템플릿 탐색 함수 업데이트:
```php
// 일반 템플릿과 D2S 템플릿 모두 스캔
function gp_child_add_page_templates($post_templates, $wp_theme, $post, $post_type) {
    // 1. 일반 templates/ 폴더 스캔
    $templates_dir = get_stylesheet_directory() . '/templates/';
    
    // 2. D2S v1 page-templates/ 폴더 스캔 (추가)
    $d2s_templates_dir = get_stylesheet_directory() . '/d2s-v1/page-templates/';
    
    // D2S 템플릿은 "(D2S v1)" 표시 추가
    $post_templates[$template_slug] = $template_data['Template Name'] . ' (D2S v1)';
}
```

### 3. gp-d2s-v1.php 생성 및 이동
새 위치: `/d2s-v1/includes/gp-d2s-v1.php`

주요 경로 변경:
```php
// 버전 업데이트
define('D2S_VERSION', '1.0.1');

// Common CSS 경로 변경
D2S_SYSTEM_URL . '/common-assets/css/d2s-v1-common.css'

// Page assets 경로 변경
$page_path = D2S_SYSTEM_URL . '/page-assets/' . $page_name . '/';
$page_dir = D2S_SYSTEM_PATH . '/page-assets/' . $page_name . '/';

// 템플릿 감지 로직 업데이트
if (strpos($template, 'd2s-v1/page-templates/') === 0) {
    // D2S v1 템플릿 처리
}
```

새로운 헬퍼 함수 추가:
```php
// 공통 이미지 URL 헬퍼
function gp_d2s_common_image_url($image_file) {
    return D2S_SYSTEM_URL . '/common-assets/images/' . $image_file;
}

// 템플릿 로더 필터
add_filter('template_include', 'gp_d2s_v1_template_include', 99);
```

### 4. 디렉토리 구조 생성
```bash
mkdir -p src/themes/generatepress_child/d2s-v1/{docs,includes,common-assets/{css,js,images/symbol},page-templates,page-assets}
```

### 5. 파일 이동
D2S 페이지 템플릿 7개 이동:
- page-account-outsourcing.php
- page-professional-center.php
- page-request-consulting.php
- page-tax-appeal.php
- page-tax-audit-support.php
- page-tax-bookkeeping.php
- page-tax-consulting.php

일반 템플릿 2개는 유지:
- about-us.php
- tax-services.php

### 6. 공통 CSS 파일 생성
`/d2s-v1/common-assets/css/d2s-v1-common.css` 생성
- D2S 시스템 기본 스타일
- 컨테이너, 그리드, 카드, 버튼 클래스
- 유틸리티 클래스
- 반응형 헬퍼

## 완료된 변경사항

### 파일 시스템
- D2S v1 독립 폴더 구조 생성
- gp-d2s-v1.php를 d2s-v1/includes/로 이동
- 7개 D2S 템플릿을 d2s-v1/page-templates/로 이동
- common-assets 폴더명 변경 (v1.0.1 요구사항)
- page-assets 폴더명 변경

### 코드 업데이트
- functions.php include 경로 수정
- 템플릿 탐색 함수 업데이트
- gp-d2s-v1.php 경로 업데이트
- 버전 번호 1.0.1로 업데이트
- 새로운 헬퍼 함수 추가

### 기능 개선
- WordPress 관리자에서 D2S 템플릿 "(D2S v1)" 표시
- 템플릿 자동 경로 탐색
- 공통 이미지 URL 헬퍼 함수
- Admin 알림 기능 (파일 누락 시)

## 주요 이점

1. **Repository 분리 용이**
   - child-theme과 d2s-v1 코드가 명확히 분리
   - 독립적인 Git repository 관리 가능

2. **유지보수 향상**
   - D2S v1 시스템 파일들이 한 곳에 집중
   - 버전별 관리 용이

3. **확장성 개선**
   - 향후 D2S v2 시스템 추가 시 병렬 운영 가능
   - 플러그인화 가능한 구조

## 주의사항

1. **WordPress 페이지 설정 업데이트 필요**
   - 기존 페이지들의 템플릿 재선택 필요
   - 관리자 > 페이지 > 편집에서 새 템플릿 위치 선택

2. **캐시 초기화**
   - WordPress 캐시 플러그인 초기화
   - 브라우저 캐시 삭제

3. **경로 확인**
   - CSS 내 상대경로 점검
   - JavaScript 파일 경로 확인

## 마이그레이션 가이드

### 기존 사이트 업데이트 방법
1. 백업 생성
2. 새 폴더 구조 생성
3. 파일 이동 (위 작업 과정 참조)
4. functions.php 업데이트
5. WordPress 관리자에서 페이지 템플릿 재설정
6. 캐시 초기화
7. 테스트

### 롤백 방법
1. functions.php의 include 경로 원복
2. 템플릿 파일들을 templates/ 폴더로 이동
3. d2s-v1 폴더 삭제
4. 캐시 초기화

## 테스트 체크리스트

- [ ] WordPress 관리자에서 템플릿 목록 확인
- [ ] D2S 템플릿에 "(D2S v1)" 표시 확인
- [ ] 각 페이지 템플릿 정상 로드
- [ ] CSS 파일 정상 로드
- [ ] JS 파일 정상 로드 (해당 시)
- [ ] 이미지 경로 정상 작동
- [ ] 반응형 레이아웃 확인
- [ ] 콘솔 에러 없음 확인

## 다음 단계

1. **D2S v1 문서 정리**
   - implementation guide 업데이트
   - quick setup guide 업데이트

2. **자동화 스크립트 작성**
   - 마이그레이션 자동화
   - 템플릿 생성 자동화

3. **플러그인화 검토**
   - D2S v1을 독립 플러그인으로 전환 가능성 검토

---

**작성자**: Claude Code  
**검토자**: [검토 필요]  
**승인**: [승인 대기]